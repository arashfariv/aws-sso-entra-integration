<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS SSO Integration - Architecture Diagrams</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #1a4480;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
        }
        
        .diagram-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            page-break-inside: avoid;
        }
        
        .diagram-section h2 {
            color: #1a4480;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        /* Organization Hierarchy Styles */
        .org-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .org-level {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .org-node {
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 140px;
            position: relative;
        }
        
        .org-node.root {
            background: linear-gradient(135deg, #1a4480, #2c5aa0);
            color: white;
            font-weight: bold;
        }
        
        .org-node.management {
            background: linear-gradient(135deg, #d4380d, #ff4d4f);
            color: white;
        }
        
        .org-node.ou {
            background: linear-gradient(135deg, #0958d9, #4096ff);
            color: white;
        }
        
        .org-node.account {
            background: linear-gradient(135deg, #389e0d, #52c41a);
            color: white;
            font-size: 0.9em;
        }
        
        .org-node.security {
            background: linear-gradient(135deg, #531dab, #722ed1);
            color: white;
        }
        
        .connector-line {
            width: 2px;
            height: 20px;
            background: #ccc;
        }
        
        .horizontal-connector {
            height: 2px;
            background: #ccc;
            width: 80%;
            margin: 10px 0;
        }
        
        /* Identity Flow Styles */
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            padding: 20px;
        }
        
        .flow-box {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
        }
        
        .flow-box.entra {
            background: linear-gradient(135deg, #0078d4, #00bcf2);
            color: white;
        }
        
        .flow-box.aws {
            background: linear-gradient(135deg, #ff9900, #ffb84d);
            color: #232f3e;
        }
        
        .flow-box.protocol {
            background: #f0f0f0;
            border: 2px dashed #999;
            font-size: 0.85em;
        }
        
        .flow-arrow {
            font-size: 24px;
            color: #666;
        }
        
        /* SCP Diagram Styles */
        .scp-grid {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            width: 100%;
        }
        
        .scp-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .scp-item {
            padding: 15px;
            background: linear-gradient(135deg, #cf1322, #ff4d4f);
            color: white;
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .scp-targets {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .scp-target-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .scp-arrow {
            color: #cf1322;
            font-size: 20px;
            min-width: 30px;
        }
        
        .target-ous {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .target-ou {
            padding: 8px 15px;
            background: #e6f4ff;
            border: 2px solid #0958d9;
            border-radius: 6px;
            font-size: 0.85em;
        }
        
        /* Permission Set Diagram */
        .perm-flow {
            width: 100%;
        }
        
        .perm-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: #fafafa;
            border-radius: 8px;
            border-left: 4px solid #1a4480;
        }
        
        .perm-group {
            padding: 10px 15px;
            background: #e6f4ff;
            border-radius: 6px;
            font-weight: bold;
            color: #0958d9;
        }
        
        .perm-set {
            padding: 10px 15px;
            background: #fff7e6;
            border-radius: 6px;
            color: #d46b08;
        }
        
        .perm-accounts {
            display: flex;
            gap: 8px;
        }
        
        .perm-account {
            padding: 8px 12px;
            background: #f6ffed;
            border-radius: 6px;
            color: #389e0d;
            font-size: 0.85em;
        }
        
        .perm-arrow {
            color: #999;
            font-size: 18px;
        }
        
        /* Defense in Depth */
        .defense-layers {
            width: 100%;
            max-width: 700px;
        }
        
        .defense-layer {
            padding: 20px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .defense-layer.layer1 { background: linear-gradient(90deg, #ff4d4f, #ff7875); color: white; }
        .defense-layer.layer2 { background: linear-gradient(90deg, #fa8c16, #ffa940); color: white; }
        .defense-layer.layer3 { background: linear-gradient(90deg, #fadb14, #ffec3d); color: #333; }
        .defense-layer.layer4 { background: linear-gradient(90deg, #52c41a, #73d13d); color: white; }
        .defense-layer.layer5 { background: linear-gradient(90deg, #1890ff, #40a9ff); color: white; }
        .defense-layer.layer6 { background: linear-gradient(90deg, #722ed1, #9254de); color: white; }
        
        .layer-num {
            font-size: 1.5em;
            font-weight: bold;
            min-width: 40px;
        }
        
        .layer-content {
            flex: 1;
        }
        
        .layer-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .layer-desc {
            font-size: 0.85em;
            opacity: 0.9;
        }
        
        /* Lifecycle Flow */
        .lifecycle-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .lifecycle-box {
            flex: 1;
            min-width: 250px;
            max-width: 300px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .lifecycle-box.joiner {
            background: linear-gradient(135deg, #389e0d, #52c41a);
            color: white;
        }
        
        .lifecycle-box.mover {
            background: linear-gradient(135deg, #0958d9, #4096ff);
            color: white;
        }
        
        .lifecycle-box.leaver {
            background: linear-gradient(135deg, #cf1322, #ff4d4f);
            color: white;
        }
        
        .lifecycle-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .lifecycle-trigger {
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.85em;
        }
        
        .lifecycle-actions {
            text-align: left;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .lifecycle-actions li {
            margin: 5px 0;
            list-style: none;
        }
        
        .lifecycle-actions li::before {
            content: "→ ";
        }
        
        /* PIM Flow */
        .pim-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            padding: 20px;
        }
        
        .pim-step {
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
        }
        
        .pim-step.user { background: #e6f4ff; border: 2px solid #0958d9; }
        .pim-step.request { background: #fff7e6; border: 2px solid #fa8c16; }
        .pim-step.approve { background: #f6ffed; border: 2px solid #52c41a; }
        .pim-step.access { background: #f9f0ff; border: 2px solid #722ed1; }
        .pim-step.expire { background: #fff1f0; border: 2px solid #ff4d4f; }
        
        .pim-arrow {
            font-size: 20px;
            color: #666;
        }
        
        /* ABAC Diagram */
        .abac-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .abac-box {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 180px;
        }
        
        .abac-user {
            background: #e6f4ff;
            border: 2px solid #0958d9;
        }
        
        .abac-policy {
            background: #fff7e6;
            border: 2px solid #fa8c16;
        }
        
        .abac-resource {
            padding: 15px;
            border-radius: 8px;
            margin: 5px;
        }
        
        .abac-resource.match { background: #f6ffed; border: 2px solid #52c41a; }
        .abac-resource.nomatch { background: #fff1f0; border: 2px solid #ff4d4f; }
        
        .abac-result {
            font-weight: bold;
            margin-top: 10px;
        }
        
        .abac-result.allowed { color: #52c41a; }
        .abac-result.denied { color: #ff4d4f; }
        
        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* Print styles */
        @media print {
            body { background: white; }
            .diagram-section { box-shadow: none; border: 1px solid #ddd; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AWS SSO Integration Architecture</h1>
        <p class="subtitle">Microsoft Entra ID + AWS IAM Identity Center | Arash Farivar</p>
        
        <!-- Diagram 1: Organization Structure -->
        <div class="diagram-section">
            <h2>1. AWS Organization Structure</h2>
            <div class="diagram">
                <div class="org-tree">
                    <div class="org-level">
                        <div class="org-node root">
                            <strong>Root</strong><br>
                            <small>AWS Organization</small>
                        </div>
                    </div>
                    
                    <div class="connector-line"></div>
                    <div class="horizontal-connector"></div>
                    
                    <div class="org-level">
                        <div class="org-node management">
                            <strong>AF-AWS-Manage</strong><br>
                            <small>Management Account</small><br>
                            <small style="opacity:0.8">Identity Center</small>
                        </div>
                        <div class="org-node ou">
                            <strong>DEV</strong><br>
                            <small>Development OU</small>
                        </div>
                        <div class="org-node ou">
                            <strong>PROD</strong><br>
                            <small>Production OU</small>
                        </div>
                        <div class="org-node ou">
                            <strong>Sandbox</strong><br>
                            <small>Testing OU</small>
                        </div>
                        <div class="org-node security">
                            <strong>Security</strong><br>
                            <small>Security OU</small>
                        </div>
                    </div>
                    
                    <div class="connector-line"></div>
                    
                    <div class="org-level">
                        <div style="width: 140px;"></div>
                        <div class="org-node account">
                            <strong>AF-AWS-Dev</strong><br>
                            <small>Dev Workloads</small>
                        </div>
                        <div class="org-node account">
                            <strong>AF-AWS-Prod</strong><br>
                            <small>Prod Workloads</small>
                        </div>
                        <div class="org-node account">
                            <strong>ControlTowerDemo</strong><br>
                            <small>Sandbox</small>
                        </div>
                        <div class="org-node account" style="background: linear-gradient(135deg, #531dab, #722ed1);">
                            <strong>Audit + Log Archive</strong><br>
                            <small>Security Accounts</small>
                        </div>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #d4380d;"></div>
                        <span>Management Account</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #0958d9;"></div>
                        <span>Organizational Unit</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #389e0d;"></div>
                        <span>Member Account</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #531dab;"></div>
                        <span>Security Account</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Diagram 2: Identity Flow -->
        <div class="diagram-section">
            <h2>2. Identity Integration Flow</h2>
            <div class="diagram">
                <div class="flow-container">
                    <div class="flow-box entra">
                        <strong>Microsoft Entra ID</strong><br>
                        <small>Identity Provider</small><br>
                        <small style="margin-top:10px;display:block;">Users • Groups • MFA</small>
                    </div>
                    
                    <div style="display:flex;flex-direction:column;align-items:center;gap:5px;">
                        <div class="flow-box protocol">
                            <strong>SAML 2.0</strong><br>
                            <small>Authentication</small>
                        </div>
                        <span class="flow-arrow">⟷</span>
                        <div class="flow-box protocol">
                            <strong>SCIM 2.0</strong><br>
                            <small>Provisioning</small>
                        </div>
                    </div>
                    
                    <div class="flow-box aws">
                        <strong>AWS IAM Identity Center</strong><br>
                        <small>Service Provider</small><br>
                        <small style="margin-top:10px;display:block;">SSO • Permission Sets</small>
                    </div>
                    
                    <span class="flow-arrow">→</span>
                    
                    <div class="flow-box" style="background:#232f3e;color:#ff9900;">
                        <strong>AWS Accounts</strong><br>
                        <small style="color:#fff;">Dev • Prod • Sandbox</small>
                    </div>
                </div>
                
                <div style="margin-top:30px;padding:20px;background:#f9f9f9;border-radius:8px;width:100%;">
                    <strong>Data Flow:</strong>
                    <ul style="margin-top:10px;margin-left:20px;">
                        <li><strong>SAML:</strong> User authenticates → Entra validates → Sends assertion → AWS grants session</li>
                        <li><strong>SCIM:</strong> Group membership changes → Entra pushes to AWS → AWS updates access</li>
                        <li><strong>Session Tags:</strong> User attributes (department) → Passed to AWS → Used in ABAC policies</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Diagram 3: SCP Attachments -->
        <div class="diagram-section">
            <h2>3. Service Control Policy Attachments</h2>
            <div class="diagram">
                <div class="scp-grid">
                    <div class="scp-list">
                        <div class="scp-item">
                            <strong>DenyLeaveOrganization</strong><br>
                            <small>Prevent account escape</small>
                        </div>
                        <div class="scp-item">
                            <strong>DenyRootUser</strong><br>
                            <small>Block root credentials</small>
                        </div>
                        <div class="scp-item">
                            <strong>RestrictToUSEast1</strong><br>
                            <small>Region restriction</small>
                        </div>
                        <div class="scp-item" style="background: linear-gradient(135deg, #531dab, #722ed1);">
                            <strong>Control Tower Guardrails</strong><br>
                            <small>Protect audit infrastructure</small>
                        </div>
                    </div>
                    
                    <div class="scp-targets">
                        <div class="scp-target-row">
                            <span class="scp-arrow">→</span>
                            <div class="target-ous">
                                <div class="target-ou" style="background:#fff1f0;border-color:#ff4d4f;">
                                    <strong>Root</strong> (All Accounts)
                                </div>
                            </div>
                        </div>
                        <div class="scp-target-row">
                            <span class="scp-arrow">→</span>
                            <div class="target-ous">
                                <div class="target-ou">DEV</div>
                                <div class="target-ou">PROD</div>
                                <div class="target-ou">Sandbox</div>
                                <div class="target-ou" style="background:#f9f0ff;border-color:#722ed1;">Security</div>
                            </div>
                        </div>
                        <div class="scp-target-row">
                            <span class="scp-arrow">→</span>
                            <div class="target-ous">
                                <div class="target-ou">DEV</div>
                                <div class="target-ou">PROD</div>
                                <div class="target-ou">Sandbox</div>
                            </div>
                        </div>
                        <div class="scp-target-row">
                            <span class="scp-arrow">→</span>
                            <div class="target-ous">
                                <div class="target-ou" style="background:#f9f0ff;border-color:#722ed1;">Managed by Control Tower</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:20px;padding:15px;background:#fff1f0;border-radius:8px;border-left:4px solid #ff4d4f;">
                    <strong>⚠️ Important:</strong> SCPs do NOT apply to the Management Account. Break-glass IAM user is located there for emergency access.
                </div>
            </div>
        </div>
        
        <!-- Diagram 4: Permission Set Assignments -->
        <div class="diagram-section">
            <h2>4. Permission Set Assignments</h2>
            <div class="diagram">
                <div class="perm-flow">
                    <div class="perm-row">
                        <div class="perm-group">Sales-Team</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-set">SalesReadOnly</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-accounts">
                            <div class="perm-account">AF-AWS-Prod</div>
                        </div>
                    </div>
                    
                    <div class="perm-row">
                        <div class="perm-group">Engineering-Team</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-set">EngineeringPower</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-accounts">
                            <div class="perm-account">AF-AWS-Dev</div>
                            <div class="perm-account">ControlTowerDemo</div>
                        </div>
                    </div>
                    
                    <div class="perm-row">
                        <div class="perm-group">AWS-EmergencyAdmin-Eligible</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-set" style="background:#fff1f0;color:#cf1322;">EmergencyAdmin (PIM)</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-accounts">
                            <div class="perm-account">AF-AWS-Prod</div>
                        </div>
                    </div>
                    
                    <div class="perm-row">
                        <div class="perm-group">Sales-Team</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-set" style="background:#f9f0ff;color:#531dab;">DepartmentRestrictedEC2 (ABAC)</div>
                        <span class="perm-arrow">→</span>
                        <div class="perm-accounts">
                            <div class="perm-account">AF-AWS-Prod</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Diagram 5: Defense in Depth -->
        <div class="diagram-section">
            <h2>5. Defense in Depth Model</h2>
            <div class="diagram">
                <div class="defense-layers">
                    <div class="defense-layer layer1">
                        <div class="layer-num">1</div>
                        <div class="layer-content">
                            <div class="layer-title">Service Control Policies</div>
                            <div class="layer-desc">Hard ceiling — what NOBODY can do, regardless of permissions</div>
                        </div>
                    </div>
                    <div class="defense-layer layer2">
                        <div class="layer-num">2</div>
                        <div class="layer-content">
                            <div class="layer-title">Permission Sets</div>
                            <div class="layer-desc">Role-based access — what groups CAN do</div>
                        </div>
                    </div>
                    <div class="defense-layer layer3">
                        <div class="layer-num">3</div>
                        <div class="layer-content">
                            <div class="layer-title">ABAC Policies</div>
                            <div class="layer-desc">Dynamic restrictions based on user and resource attributes</div>
                        </div>
                    </div>
                    <div class="defense-layer layer4">
                        <div class="layer-num">4</div>
                        <div class="layer-content">
                            <div class="layer-title">Privileged Identity Management</div>
                            <div class="layer-desc">Just-in-time elevation with approval workflow</div>
                        </div>
                    </div>
                    <div class="defense-layer layer5">
                        <div class="layer-num">5</div>
                        <div class="layer-content">
                            <div class="layer-title">Access Reviews</div>
                            <div class="layer-desc">Periodic certification with auto-revocation</div>
                        </div>
                    </div>
                    <div class="defense-layer layer6">
                        <div class="layer-num">6</div>
                        <div class="layer-content">
                            <div class="layer-title">Audit & Logging</div>
                            <div class="layer-desc">CloudTrail + Entra logs for complete visibility</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Diagram 6: Lifecycle Workflows -->
        <div class="diagram-section">
            <h2>6. Lifecycle Workflow Automation (JML)</h2>
            <div class="diagram">
                <div class="lifecycle-container">
                    <div class="lifecycle-box joiner">
                        <div class="lifecycle-title">JOINER</div>
                        <div class="lifecycle-trigger">
                            <strong>Trigger:</strong> employeeHireDate
                        </div>
                        <div class="lifecycle-actions">
                            <li>Enable user account</li>
                            <li>Add to department group</li>
                            <li>SCIM syncs to AWS</li>
                            <li>User gets AWS access</li>
                        </div>
                    </div>
                    
                    <div class="lifecycle-box mover">
                        <div class="lifecycle-title">MOVER</div>
                        <div class="lifecycle-trigger">
                            <strong>Trigger:</strong> department change
                        </div>
                        <div class="lifecycle-actions">
                            <li>Remove from old group</li>
                            <li>Add to new group</li>
                            <li>SCIM syncs changes</li>
                            <li>AWS access updates</li>
                        </div>
                    </div>
                    
                    <div class="lifecycle-box leaver">
                        <div class="lifecycle-title">LEAVER</div>
                        <div class="lifecycle-trigger">
                            <strong>Trigger:</strong> employeeLeaveDateTime
                        </div>
                        <div class="lifecycle-actions">
                            <li>Remove from all groups</li>
                            <li>Disable user account</li>
                            <li>SCIM syncs removal</li>
                            <li>All AWS access revoked</li>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Diagram 7: PIM Flow -->
        <div class="diagram-section">
            <h2>7. PIM Just-in-Time Access Flow</h2>
            <div class="diagram">
                <div class="pim-flow">
                    <div class="pim-step user">
                        <strong>User</strong><br>
                        <small>Eligible member</small>
                    </div>
                    <span class="pim-arrow">→</span>
                    <div class="pim-step request">
                        <strong>Request</strong><br>
                        <small>+ Justification</small>
                    </div>
                    <span class="pim-arrow">→</span>
                    <div class="pim-step approve">
                        <strong>Approval</strong><br>
                        <small>Manager reviews</small>
                    </div>
                    <span class="pim-arrow">→</span>
                    <div class="pim-step access">
                        <strong>Active</strong><br>
                        <small>SCIM syncs</small>
                    </div>
                    <span class="pim-arrow">→</span>
                    <div class="pim-step expire">
                        <strong>Expire</strong><br>
                        <small>Auto-revoke (4h)</small>
                    </div>
                </div>
                
                <div style="margin-top:30px;padding:20px;background:#f6ffed;border-radius:8px;border-left:4px solid #52c41a;width:100%;">
                    <strong>✓ Zero Standing Privileges:</strong> No permanent admin access. Every privileged session requires justification, approval, and automatically expires.
                </div>
            </div>
        </div>
        
        <!-- Diagram 8: ABAC -->
        <div class="diagram-section">
            <h2>8. ABAC - Attribute-Based Access Control</h2>
            <div class="diagram">
                <div class="abac-container">
                    <div class="abac-box abac-user">
                        <strong>User: Engari</strong><br>
                        <div style="margin-top:10px;padding:8px;background:white;border-radius:5px;">
                            Department = <strong>Engineering</strong>
                        </div>
                    </div>
                    
                    <div class="abac-box abac-policy">
                        <strong>ABAC Policy</strong><br>
                        <div style="margin-top:10px;font-size:0.85em;text-align:left;">
                            Allow EC2 actions<br>
                            <strong>WHERE</strong><br>
                            ResourceTag/Department<br>
                            = PrincipalTag/Department
                        </div>
                    </div>
                    
                    <div style="display:flex;flex-direction:column;gap:10px;">
                        <div class="abac-resource match">
                            <strong>Engineering-Server</strong><br>
                            <small>Tag: Department=Engineering</small>
                            <div class="abac-result allowed">✓ ALLOWED</div>
                        </div>
                        <div class="abac-resource nomatch">
                            <strong>Sales-Server</strong><br>
                            <small>Tag: Department=Sales</small>
                            <div class="abac-result denied">✗ DENIED</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:30px;padding:15px;background:#f9f9f9;border-radius:8px;">
                    <strong>Key Benefit:</strong> One policy scales across all departments. No need to create separate permission sets for each team.
                </div>
            </div>
        </div>
        
        <!-- Diagram 9: Complete Architecture -->
        <div class="diagram-section">
            <h2>9. Complete Architecture Overview</h2>
            <div class="diagram">
                <svg viewBox="0 0 900 500" style="max-width:100%;height:auto;">
                    <!-- Background boxes -->
                    <rect x="10" y="10" width="250" height="480" rx="10" fill="#e6f4ff" stroke="#0958d9" stroke-width="2"/>
                    <rect x="320" y="10" width="250" height="480" rx="10" fill="#fff7e6" stroke="#fa8c16" stroke-width="2"/>
                    <rect x="630" y="10" width="260" height="480" rx="10" fill="#f6ffed" stroke="#52c41a" stroke-width="2"/>
                    
                    <!-- Headers -->
                    <text x="135" y="40" text-anchor="middle" font-weight="bold" fill="#0958d9">Microsoft Entra ID</text>
                    <text x="445" y="40" text-anchor="middle" font-weight="bold" fill="#fa8c16">AWS IAM Identity Center</text>
                    <text x="760" y="40" text-anchor="middle" font-weight="bold" fill="#52c41a">AWS Accounts</text>
                    
                    <!-- Entra ID Components -->
                    <rect x="30" y="60" width="210" height="40" rx="5" fill="#0958d9"/>
                    <text x="135" y="85" text-anchor="middle" fill="white" font-size="14">Users & Groups</text>
                    
                    <rect x="30" y="110" width="210" height="40" rx="5" fill="#0958d9"/>
                    <text x="135" y="135" text-anchor="middle" fill="white" font-size="14">Lifecycle Workflows</text>
                    
                    <rect x="30" y="160" width="210" height="40" rx="5" fill="#0958d9"/>
                    <text x="135" y="185" text-anchor="middle" fill="white" font-size="14">Access Reviews</text>
                    
                    <rect x="30" y="210" width="210" height="40" rx="5" fill="#722ed1"/>
                    <text x="135" y="235" text-anchor="middle" fill="white" font-size="14">PIM (JIT Access)</text>
                    
                    <rect x="30" y="260" width="210" height="40" rx="5" fill="#0958d9"/>
                    <text x="135" y="285" text-anchor="middle" fill="white" font-size="14">SAML Claims (ABAC)</text>
                    
                    <!-- AWS Identity Center Components -->
                    <rect x="340" y="60" width="210" height="40" rx="5" fill="#fa8c16"/>
                    <text x="445" y="85" text-anchor="middle" fill="white" font-size="14">Synced Users & Groups</text>
                    
                    <rect x="340" y="110" width="210" height="40" rx="5" fill="#fa8c16"/>
                    <text x="445" y="135" text-anchor="middle" fill="white" font-size="14">Permission Sets</text>
                    
                    <rect x="340" y="160" width="210" height="40" rx="5" fill="#fa8c16"/>
                    <text x="445" y="185" text-anchor="middle" fill="white" font-size="14">Account Assignments</text>
                    
                    <rect x="340" y="210" width="210" height="40" rx="5" fill="#fa8c16"/>
                    <text x="445" y="235" text-anchor="middle" fill="white" font-size="14">Session Tags</text>
                    
                    <!-- AWS Account Components -->
                    <rect x="650" y="60" width="220" height="35" rx="5" fill="#389e0d"/>
                    <text x="760" y="83" text-anchor="middle" fill="white" font-size="13">AF-AWS-Dev (DEV)</text>
                    
                    <rect x="650" y="100" width="220" height="35" rx="5" fill="#389e0d"/>
                    <text x="760" y="123" text-anchor="middle" fill="white" font-size="13">AF-AWS-Prod (PROD)</text>
                    
                    <rect x="650" y="140" width="220" height="35" rx="5" fill="#389e0d"/>
                    <text x="760" y="163" text-anchor="middle" fill="white" font-size="13">ControlTowerDemo (Sandbox)</text>
                    
                    <rect x="650" y="190" width="220" height="35" rx="5" fill="#722ed1"/>
                    <text x="760" y="213" text-anchor="middle" fill="white" font-size="13">Audit + Log Archive (Security)</text>
                    
                    <!-- SCPs Box -->
                    <rect x="650" y="250" width="220" height="80" rx="5" fill="#ff4d4f"/>
                    <text x="760" y="275" text-anchor="middle" fill="white" font-size="14" font-weight="bold">SCPs (Guardrails)</text>
                    <text x="760" y="295" text-anchor="middle" fill="white" font-size="11">• Region Restriction</text>
                    <text x="760" y="310" text-anchor="middle" fill="white" font-size="11">• Deny Root User</text>
                    <text x="760" y="325" text-anchor="middle" fill="white" font-size="11">• Deny Leave Org</text>
                    
                    <!-- Arrows -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                        </marker>
                    </defs>
                    
                    <!-- SAML Arrow -->
                    <line x1="240" y1="80" x2="340" y2="80" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <text x="290" y="70" text-anchor="middle" fill="#666" font-size="10">SAML</text>
                    
                    <!-- SCIM Arrow -->
                    <line x1="240" y1="130" x2="340" y2="80" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <text x="280" y="95" text-anchor="middle" fill="#666" font-size="10">SCIM</text>
                    
                    <!-- To AWS Accounts -->
                    <line x1="550" y1="130" x2="650" y2="130" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <!-- Break Glass Box -->
                    <rect x="30" y="420" width="210" height="60" rx="5" fill="#d4380d"/>
                    <text x="135" y="445" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Break-Glass Access</text>
                    <text x="135" y="465" text-anchor="middle" fill="white" font-size="11">IAM User in Management Account</text>
                    
                    <!-- Management Account -->
                    <rect x="650" y="420" width="220" height="60" rx="5" fill="#d4380d"/>
                    <text x="760" y="445" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Management Account</text>
                    <text x="760" y="465" text-anchor="middle" fill="white" font-size="11">SCPs don't apply here</text>
                    
                    <!-- Break glass arrow -->
                    <line x1="240" y1="450" x2="650" y2="450" stroke="#d4380d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
                    <text x="445" y="440" text-anchor="middle" fill="#d4380d" font-size="10">Emergency Access (bypasses Entra)</text>
                </svg>
            </div>
        </div>
        
        <!-- Diagram 10: CLI Access Flow -->
        <div class="diagram-section">
            <h2>10. CLI Access Flow</h2>
            <div class="diagram">
                <div class="flow-container">
                    <div class="flow-box" style="background:#333;color:#0f0;">
                        <strong>Developer Terminal</strong><br>
                        <small style="color:#ccc;">aws sso login</small>
                    </div>
                    
                    <span class="flow-arrow">→</span>
                    
                    <div class="flow-box entra">
                        <strong>Entra ID</strong><br>
                        <small>MFA Authentication</small>
                    </div>
                    
                    <span class="flow-arrow">→</span>
                    
                    <div class="flow-box aws">
                        <strong>Identity Center</strong><br>
                        <small>Session Token</small>
                    </div>
                    
                    <span class="flow-arrow">→</span>
                    
                    <div class="flow-box" style="background:#f6ffed;border:2px solid #52c41a;">
                        <strong>Temp Credentials</strong><br>
                        <small>1 hour expiry</small>
                    </div>
                </div>
                
                <div style="margin-top:30px;display:flex;justify-content:space-around;flex-wrap:wrap;gap:20px;">
                    <div style="padding:20px;background:#fff1f0;border-radius:8px;border-left:4px solid #ff4d4f;flex:1;min-width:250px;">
                        <strong>❌ Traditional (Insecure)</strong>
                        <ul style="margin-top:10px;margin-left:20px;">
                            <li>Long-term access keys</li>
                            <li>Stored in ~/.aws/credentials</li>
                            <li>Manual rotation</li>
                            <li>No MFA</li>
                        </ul>
                    </div>
                    <div style="padding:20px;background:#f6ffed;border-radius:8px;border-left:4px solid #52c41a;flex:1;min-width:250px;">
                        <strong>✓ SSO (Secure)</strong>
                        <ul style="margin-top:10px;margin-left:20px;">
                            <li>Temporary credentials</li>
                            <li>Auto-expire in 1 hour</li>
                            <li>MFA enforced</li>
                            <li>Full audit trail</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Diagram 11: CloudTrail Audit Flow -->
        <div class="diagram-section">
            <h2>11. CloudTrail Audit Architecture</h2>
            <div class="diagram">
                <div style="display:flex;justify-content:center;align-items:center;gap:30px;flex-wrap:wrap;">
                    <div style="display:flex;flex-direction:column;gap:10px;">
                        <div style="padding:15px;background:#e6f4ff;border:2px solid #0958d9;border-radius:8px;text-align:center;">
                            <strong>SSO Events</strong><br>
                            <small>Federate, GetRoleCredentials</small>
                        </div>
                        <div style="padding:15px;background:#fff7e6;border:2px solid #fa8c16;border-radius:8px;text-align:center;">
                            <strong>EC2 Events</strong><br>
                            <small>Start, Stop, Terminate</small>
                        </div>
                        <div style="padding:15px;background:#f6ffed;border:2px solid #52c41a;border-radius:8px;text-align:center;">
                            <strong>IAM Events</strong><br>
                            <small>CreateUser, AttachPolicy</small>
                        </div>
                        <div style="padding:15px;background:#f9f0ff;border:2px solid #722ed1;border-radius:8px;text-align:center;">
                            <strong>All API Calls</strong><br>
                            <small>Every service, every action</small>
                        </div>
                    </div>
                    
                    <div style="font-size:30px;color:#666;">→</div>
                    
                    <div style="padding:25px;background:linear-gradient(135deg,#ff9900,#ffb84d);border-radius:10px;text-align:center;color:#232f3e;">
                        <strong style="font-size:1.2em;">CloudTrail</strong><br>
                        <small>aws-controltower-BaselineCloudTrail</small><br>
                        <small style="display:block;margin-top:10px;">Organization-wide</small>
                    </div>
                    
                    <div style="font-size:30px;color:#666;">→</div>
                    
                    <div style="display:flex;flex-direction:column;gap:10px;">
                        <div style="padding:15px;background:#232f3e;color:#ff9900;border-radius:8px;text-align:center;">
                            <strong>S3 Bucket</strong><br>
                            <small style="color:#fff;">Long-term storage</small>
                        </div>
                        <div style="padding:15px;background:#232f3e;color:#ff9900;border-radius:8px;text-align:center;">
                            <strong>CloudWatch Logs</strong><br>
                            <small style="color:#fff;">Real-time queries</small>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:30px;padding:20px;background:#f9f9f9;border-radius:8px;">
                    <strong>What Gets Logged:</strong>
                    <div style="display:flex;justify-content:space-around;flex-wrap:wrap;gap:20px;margin-top:15px;">
                        <div><strong>Who:</strong> User identity, IP address</div>
                        <div><strong>What:</strong> API action, parameters</div>
                        <div><strong>When:</strong> Timestamp</div>
                        <div><strong>Where:</strong> Region, account</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="text-align:center;padding:20px;color:#666;">
            <p>AWS SSO Integration Architecture Diagrams | Arash Farivar | January 2026 | v3.0</p>
        </div>
    </div>
</body>
</html>
